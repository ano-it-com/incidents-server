## Разворачивание окружения для разработки:  

1. Установить зависимости:  
 - Docker v18.09+
 - Docker-compose v1.23+
 - Git v2.8+ 
 - Make  

2. Клонировать репозиторий:  
```
$ git clone ssh://** ./
```

3. Указать свободные интерфейсы в системе:  
Переменные `FREE_INTERFACE_*` в файле [docker/.env](docker/.env) задают интерфейсы, которые будут заняты при старте контейнеров. 
При необходимости можно внести пременные в файл docker/.env.override (файл находится в исключениях git), которые перезапишут 
настройки в файле [docker/.env](docker/.env)

`Не обязательно, если вас устраивает конфигурация по умолчанию в docker/.env`

4. Добавление текущего пользователя в группу docker (для того чтобы не писать sudo команд докера)
```
sudo usermod -aG docker ${USER}
```

5. Собрать образы и запустить сервисы:  
```
$ make build
$ make up
```
` !!! На этапе make up локально запускается контейнер composer, который запускает установку пакетов, это может занять время. 
В это время контейнер php может перезапускаться из-за ошибки отсутствующего autoload (при первом развертывании) файла. Контролировать процесс установки 
пакетов composer можно выполнив команду:`
```
$ make log-composer
```

6. Добавить записи с адресами сервисов в /etc/hosts:  
```
$ sudo make hosts
```

`Не обязательно, можно обращаться по ip, см:` [docker/development/docker-compose.yml](docker/development/docker-compose.yml)

7. Подгрузка фикстур для наполнения тестовыми данными
```
$ make bash-php
$ php bin/console d:f:l
```

`Не обязательно, без фикстур будет пустая система`

7. Задать реквизиты коммитера для репозитория:  
```
$ git config user.name "Иванов Иван"
$ git config user.email "XXX@bix.ru"
```

## Результат  

После успешной установки будут доступны следующие сервисы:
 - http://ims.server.sr - Разрабатываемый сервис
 - http://ims.server.sr/api/doc - Документация по методам
 - tcp://ims.postgres.sr - База данных

`Если FREE_PORT отличен от 80, то необходимо указывать порт через ":", например: http://ims.server.sr:1010`

## Запуск локальных тестов
```
$ make test-functional
```

## Настройка Xdebug
[Инструкция](documentation/xdebug.md)

## Пользователи по умолчанию  

Администратор (из фикстур):  
```
admin 
imsqweqwe
```

## Херперы для работы  

Просмотр логов контейнера:  
make log-{service}, например:  
```
$ make log-mysql
```

Вход в контейнер:  
make bash-{service}, например:  
```
$ make bash-php
```

Остальные команды можно посмотреть здесь: [docker/development/Makefile](./docker/development/Makefile)
